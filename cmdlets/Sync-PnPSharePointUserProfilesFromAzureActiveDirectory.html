<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Sync-PnPSharePointUserProfilesFromAzureActiveDirectory | PnP PowerShell </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Sync-PnPSharePointUserProfilesFromAzureActiveDirectory | PnP PowerShell ">
    <meta name="generator" content="docfx ">
  <meta name="description" content="PnP PowerShell is an open source, community driven, PowerShell Module designed to work with Microsoft 365.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
  
  <meta property="docfx:rel" content="../">
  <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/powershell/blob/dev/documentation/#L1" title="Edit this page" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
  <h1 id="sync-pnpsharepointuserprofilesfromazureactivedirectory">Sync-PnPSharePointUserProfilesFromAzureActiveDirectory</h1>

<h2 id="synopsis">SYNOPSIS</h2>
<p><strong>Required Permissions</strong></p>
<ul>
<li>SharePoint: Sites.FullControl.All, TermStore.ReadWrite.All, User.ReadWrite.All</li>
<li>Microsoft Graph: User.Read</li>
<li>ACS: No longer needed</li>
</ul>
<p>Synchronizes user profiles from Entra ID into the SharePoint Online User Profiles</p>
<h2 id="syntax">SYNTAX</h2>
<h3 id="upload-file">Upload file</h3>
<pre><code class="lang-powershell">Sync-PnPSharePointUserProfilesFromAzureActiveDirectory -UserProfilePropertyMapping &lt;Hashtable&gt; [-IdType &lt;Enum&gt;] [-Users &lt;Array&gt;] [-Folder &lt;String&gt;] [-Wait] [-Verbose] [-Connection &lt;PnPConnection&gt;] [-WhatIf]
</code></pre>
<h2 id="description">DESCRIPTION</h2>
<p>This cmdlet allows synchronizing user profiles from Entra ID to their SharePoint Online User Profile equivalents. Note that certain properties are already synced by default. A list of these can be found here: <a href="https://learn.microsoft.com/sharepoint/user-profile-sync#properties-that-are-synced-into-sharepoint-user-profiles">https://learn.microsoft.com/sharepoint/user-profile-sync#properties-that-are-synced-into-sharepoint-user-profiles</a></p>
<p>For other properties not listed on this page, you can use this cmdlet to synchronize them. You can provide the property name(s) in Entra ID and specify its equivalent property in SharePoint Online for the values to be mapped to.</p>
<p>Note that SharePoint Online User Profile properties you wish to sync to <em>must</em> have the checkbox unchecked for &quot;Allow users to edit values for this property&quot; in the user profile property in the SharePoint User Profile service application. It also <em>must</em> have &quot;User can override&quot; checked under Policy Settings of the user profile property in the SharePoint User Profile service application.</p>
<p>When running this cmdlet, it will upload a file named <code>userprofilesyncdata-&lt;timestamp&gt;-&lt;guid&gt;.json</code> to the document library of the SharePoint Online site you are connected to. From there an asynchronous process will be started that processes the JSON file and updates the user profiles on the SharePoint Online side. The time before this process starts varies. Once that process is done and only if something failed, you will find a new folder created in the same document library of which the folder name starts with the same name as the filename. It will contain a .log file in which you can find the results of it trying to update the user profiles in SharePoint Online which were specified in the JSON file. If all the user profile properties have been updated successfully, it will not create such a folder and log file.</p>
<p>You can also query the import job status using <code>Get-PnPUPABulkImportStatus -JobId &lt;jobid&gt;</code>. The jobid will be returned upon running this cmdlet and can be fed into this cmdlet to get the actual status. It will show <code>State: Submitted</code> after running this cmdlet and before processing it and <code>State: Succeeded</code> once its done and was successful or <code>State: Error</code> if it failed. It will also return full details on the file it will use to update the user profiles and the location of the log file once its done processing and only if it failed. For documentation on all the possible states it can be in, see <a href="https://learn.microsoft.com/sharepoint/dev/solution-guidance/bulk-user-profile-update-api-for-sharepoint-online#parameters-2">https://learn.microsoft.com/sharepoint/dev/solution-guidance/bulk-user-profile-update-api-for-sharepoint-online#parameters-2</a>.</p>
<p>When not providing -Users, it will fetch all the users and the properties defined in the mapping from Entra ID itself. You can also opt to query for a subset of Entra ID users to update using i.e. <code>Get-PnPAzureAdUser</code> and feed the outcome of that to the -Users parameter. In this case you must ensure that the user objects you supply contain the properties you wish to sync towards SharePoint Online.</p>
<p>When not providing -Folder, it will assume a document library named &quot;Shared Documents&quot; is present within the site collection you're currently connected to. In case you are not using an English site collection, this name may be different and localized. In that case use the -Folder parameter passing in the localized name of the document library you wish to upload the mapping file to.</p>
<p><strong>Required Permissions</strong></p>
<p>It is no longer needed to use ACS permissions for this cmdlet to work. The following permissions, granted through an Entra ID application registration, should suffice. It can also be used using a Managed Identity within Azure using the same permissions.</p>
<ul>
<li>SharePoint: Sites.FullControl.All, TermStore.ReadWrite.All, User.ReadWrite.All</li>
<li>Microsoft Graph: User.Read</li>
</ul>
<h2 id="examples">EXAMPLES</h2>
<h3 id="example-1">EXAMPLE 1</h3>
<pre><code class="lang-powershell">Sync-PnPSharePointUserProfilesFromAzureActiveDirectory -UserProfilePropertyMapping @{&quot;HomePhone&quot;=&quot;phone&quot;;&quot;CustomProperty&quot;=&quot;DisplayName&quot;}
</code></pre>
<p>This will retrieve all users in Entra ID and take its phone property to update in the HomePhone field in the SharePoint Online user profiles for each of these users. Similarly it will set the SharePoint Online User Profile property named CustomProperty to the value of the DisplayName as set in Entra ID on the user object. It will upload the JSON file with the instructions for the update to the 'Shared Documents' library of the site currently connected to.</p>
<h3 id="example-2">EXAMPLE 2</h3>
<pre><code class="lang-powershell">$users = Get-PnPAzureADUser -Filter &quot;jobTitle eq 'IT Administrator'&quot;
Sync-PnPSharePointUserProfilesFromAzureActiveDirectory -UserProfilePropertyMapping @{&quot;CostCenter&quot;=&quot;extension_b0b5aaa58a0a4287acd826c5b8330e48_CostCenter&quot;} -Users $users
</code></pre>
<p>This will update the CostCenter SharePoint Online User Profile property with the value of the property extension_b0b5aaa58a0a4287acd826c5b8330e48_CostCenter coming from Entra ID for the users getting returned by the Get-PnPAzureADUser query. It will upload the JSON file with the instructions for the update to the 'Shared Documents' library of the site currently connected to.</p>
<h3 id="example-3">EXAMPLE 3</h3>
<pre><code class="lang-powershell">$delta = Get-PnPAzureADUser -Delta -DeltaToken $delta.DeltaToken
Sync-PnPSharePointUserProfilesFromAzureActiveDirectory -UserProfilePropertyMapping @{&quot;CostCenter&quot;=&quot;extension_b0b5aaa58a0a4287acd826c5b8330e48_CostCenter&quot;} -Users $delta.Users
</code></pre>
<p>This will retrieve all the users from Entra ID and includes a DeltaToken in the response. Using the DeltaToken you can retrieve only those users which have had changes done to their attributes since the DeltaToken was given out. This makes it ideal to use with the profile sync as this way you only will sync those users that have had changes to their profiles. Only for those users this will update the CostCenter SharePoint Online User Profile property with the value of the property extension_b0b5aaa58a0a4287acd826c5b8330e48_CostCenter coming from Entra ID. It will upload the JSON file with the instructions for the update to the 'Shared Documents' library of the site currently connected to.</p>
<h3 id="example-4">EXAMPLE 4</h3>
<pre><code class="lang-powershell">Sync-PnPSharePointUserProfilesFromAzureActiveDirectory -UserProfilePropertyMapping @{&quot;CostCenter&quot;=&quot;extension_b0b5aaa58a0a4287acd826c5b8330e48_CostCenter&quot;} -Folder &quot;User Profile Sync&quot;
</code></pre>
<p>This will retrieve all users in Entra ID and take its extension property named CostCenter to update in the CostCenter field in the SharePoint Online user profiles for each of these users. It will upload the JSON file with the instructions for the update to a library named 'User Profile Sync' in the site currently connected to.</p>
<h3 id="example-5">EXAMPLE 5</h3>
<pre><code class="lang-powershell">Sync-PnPSharePointUserProfilesFromAzureActiveDirectory -UserProfilePropertyMapping @{&quot;CostCenter&quot;=&quot;extension_b0b5aaa58a0a4287acd826c5b8330e48_CostCenter&quot;} -Folder &quot;User Profile Sync\Jobs&quot; -Wait -Verbose
</code></pre>
<p>This will retrieve all users in Entra ID and take its extension property named CostCenter to update in the CostCenter field in the SharePoint Online user profiles for each of these users. It will upload the JSON file with the instructions for the update to the folder Jobs inside a library named 'User Profile Sync' in the site currently connected to. It will wait with continuing the execution of the remainder of your script until the synchronization process has either completed or failed. It will output verbose logging to provide input on its status while executing. Notice that it may very well take 10 minutes or more for the synchronization to complete.</p>
<h2 id="parameters">PARAMETERS</h2>
<h3 id="-users">-Users</h3>
<p>Through this parameter you can pass in users coming forward from a query through Get-PnPAzureADUser that need to have their SharePoint Online User profiles updated</p>
<pre><code class="lang-yaml">Type: System.Collections.Generic.List`1[PnP.Framework.Graph.Model.User]
Parameter Sets: (All)

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
</code></pre>
<h3 id="-folder">-Folder</h3>
<p>The site relative name of the folder or document library to upload the JSON files containing the user profiles to be updated. I.e. 'Shared Documents' to upload it to the root of the default Documents library in a Team site. If you want to specify a folder inside the document library, you can use i.e. 'Shared Documents\Somefolder'. If you are not using a site collection in the English language, be sure to provide this parameter passing in the localized name of your library instead.</p>
<pre><code class="lang-yaml">Type: String
Parameter Sets: (All)

Required: False
Position: Named
Default value: &quot;Shared Documents&quot;
Accept pipeline input: False
Accept wildcard characters: False
</code></pre>
<h3 id="-userprofilepropertymapping">-UserProfilePropertyMapping</h3>
<p>A hashtable containing the SharePoint Online User Profile property to update as the key and as the value the Entra ID user profile property from which the value should be copied. It is possible to copy one Entra ID user profile property to multiple SharePoint Online User Profile property fields. It is also possible to provide multiple mappings at once. For SharePoint Online, please be sure to take the actual property name as shown on the User Profile property page at <a href="https://tenant-admin.sharepoint.com/_layouts/15/TenantProfileAdmin/MgrProperty.aspx?ProfileType=User&amp;ApplicationID=00000000%2D0000%2D0000%2D0000%2D000000000000">https://tenant-admin.sharepoint.com/_layouts/15/TenantProfileAdmin/MgrProperty.aspx?ProfileType=User&amp;ApplicationID=00000000%2D0000%2D0000%2D0000%2D000000000000</a> and not its display name as these can easily be mixed up.</p>
<p>I.e. @{&quot;SharePointUserProfileProperty1&quot;=&quot;AzureADUserProperty1&quot;;&quot;SharePointUserProfileProperty2&quot;=&quot;AzureADUserProperty2&quot;}</p>
<pre><code class="lang-yaml">Type: Hashtable
Parameter Sets: (All)

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
</code></pre>
<h3 id="-idtype">-IdType</h3>
<p>The type of profile identifier (Email/CloudId/PrincipalName). Defaults to CloudId. Ensure that if you use this in combination with <code>-Users</code> that all of the user objects you're passing in are having their Mail property populated when choosing IdType Email, Id property for IdType CloudId or UserPrincipalName for IdType PrincipalName.</p>
<pre><code class="lang-yaml">Type: ImportProfilePropertiesUserIdType
Parameter Sets: (All)
Accepted values: Email, CloudId, PrincipalName

Required: False
Default value: CloudId
Accept pipeline input: False
Accept wildcard characters: False
</code></pre>
<h3 id="-whatif">-WhatIf</h3>
<p>Will retrieve the users from Entra ID and create and upload the mappings JSON file, but will not invoke a request to SharePoint Online to queue the import process. This way you can examine the mappings JSON file on SharePoint Online first to ensure the mappings are being done correctly.</p>
<pre><code class="lang-yaml">Type: SwitchParameter
Parameter Sets: (All)
Aliases: wi

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
</code></pre>
<h3 id="-wait">-Wait</h3>
<p>Adding this parameter will cause the script to start the user profile sync operation and wait with proceeding with the rest of the script until the user profiles have been imported into the SharePoint Online user profile. It can take a long time for the user profile sync operation to complete. It will check every 30 seconds for the current status of the job, to avoid getting throttled. The check interval is non configurable.</p>
<p>Add <code>-Verbose</code> as well to be notified about the progress while waiting.</p>
<pre><code class="lang-yaml">Type: SwitchParameter
Parameter Sets: (All)

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
</code></pre>
<h3 id="-verbose">-Verbose</h3>
<p>When provided, additional debug statements will be shown while going through the user profile sync steps.</p>
<pre><code class="lang-yaml">Type: SwitchParameter
Parameter Sets: (All)

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
</code></pre>
<h2 id="related-links">RELATED LINKS</h2>
<p><a href="https://aka.ms/m365pnp">Microsoft 365 Patterns and Practices</a></p>

</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
            <img src="https://m365-visitor-stats.azurewebsites.net/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "ag6usxufyq");
    </script>  </body>
</html>