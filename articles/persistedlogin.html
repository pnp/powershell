<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Persisted Login | PnP PowerShell </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Persisted Login | PnP PowerShell ">
    <meta name="generator" content="docfx ">
  <meta name="description" content="PnP PowerShell is an open source, community driven, PowerShell Module designed to work with Microsoft 365.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
  
  <meta property="docfx:rel" content="../">
  <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/powershell/blob/dev/pages/articles/persistedlogin.md/#L1" title="Edit this page" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
  <h1 id="persisted-login">Persisted Login</h1>

<p>Starting with PnP PowerShell 3.0, the <code>Connect-PnPOnline</code> cmdlet has been updated to allow <code>-PersistLogin</code> to be provided. Documentation for it can be <a href="../cmdlets/Connect-PnPOnline.html#-persistlogin">found here</a>. This parameter allows you to persist the delegated authentication token retrieved through an interactive login in a local file on your machine, which can be used for subsequent connections without requiring re-authentication.</p>
<p>This feature is particularly useful for scenarios where you need to run scripts or tasks that require authentication but do not want to enter your credentials every time. The risk obviously will be that anyone with access to your machine can use the token to authenticate against your tenant.</p>
<h2 id="where-is-the-token-stored">Where is the token stored</h2>
<p>The token is stored in a file in the <code>%LOCALAPPDATA%\.m365pnppowershell</code> folder on Windows or <code>$HOME/.m365pnppowershell</code> on Linux and MacOS. The file is encrypted using the Data Protection API (DPAPI) on Windows or the Keychain on MacOS and Linux.</p>
<p>This means that the token is securely stored and cannot be easily accessed by unauthorized users nor can it be copied to another machine as the encryption is tied to the machine on which it has been generated. However, it is important to note that if you share your machine with others, they may be able to access the token if they have access to your user profile.</p>
<h2 id="how-does-it-work">How does it work</h2>
<p>When you use the <code>-PersistLogin</code> parameter with the <code>Connect-PnPOnline</code> cmdlet, PnP PowerShell will authenticate you as normal but will also store the refresh token in a local file. The next time you run <code>Connect-PnPOnline</code>, PnP PowerShell will check if a valid token already exists in the local file for the tenant or site you are trying to connect to. If a valid token is found, it will be used to authenticate without prompting for credentials. If no valid token is found, PnP PowerShell will prompt for credentials as normal.</p>
<p>You do not need to specify the <code>-PersistLogin</code> parameter again for subsequent connections unless you want to change the behavior.</p>
<h2 id="clearing-the-persisted-login">Clearing the persisted login</h2>
<p>If you want to clear the persisted login and remove the stored token, you can connect to the tenant for which you would like to remove the stored token first and then use the <code>Disconnect-PnPOnline</code> cmdlet with the <code>-ClearPersistedLogin</code> option. Documentation for it can be <a href="../cmdlets/Disconnect-PnPOnline.html#-clearpersistedlogin">found here</a>. This will delete the token from the local file and require you to authenticate again the next time you run <code>Connect-PnPOnline</code>.</p>
<h2 id="faq">FAQ</h2>
<h3 id="can-i-use--persistlogin-in-azure">Can I use <code>-PersistLogin</code> in Azure?</h3>
<p>No you cannot, as there are no profiles folders in Azure.</p>
<h3 id="can-i-use--persistlogin-with-an-app-only-context">Can I use <code>-PersistLogin</code> with an app only context?</h3>
<p>No, it is meant to be used for an interactive delegated authentication context only. If you want to use an app only context, you can just use the parameters with the <code>Connect-PnPOnline</code> cmdlet that support app only authentication as normal. Documentation for it can be <a href="../cmdlets/Connect-PnPOnline.html#app-only-with-azure-active-directory">found here</a>.</p>
<h3 id="do-i-still-need-my-own-application-registration-in-entra-id-when-using--persistlogin">Do I still need my own application registration in Entra ID when using <code>-PersistLogin</code>?</h3>
<p>Yes, this is still required.</p>
<h3 id="can-i-use-a-different-application-registration-for--persistlogin-for-different-tenants-or-even-site-collections-on-the-same-tenant">Can I use a different application registration for <code>-PersistLogin</code> for different tenants or even site collections on the same tenant?</h3>
<p>Yes, that is supported. Just use it as described above and it will store the token for the tenant or site collection you are connecting to.</p>

</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
            <img src="https://m365-visitor-stats.azurewebsites.net/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "ag6usxufyq");
    </script>  </body>
</html>